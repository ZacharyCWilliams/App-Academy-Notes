## Testing With Rails

We test our code to:

* make sure our code works as intended
* reduce necessary refactors
* make collaboration easier
* produce documentation (We NEED our code to be readable)

## Testing Pyramid

``` 
          -
      End To End
        ------
      Integration
    --------------
         Unit
-----------------------
```

They're three types of tests:

* Unit tests make sure that each individual unit of our code works (We write these on Models)
* Integration tests make sure that different parts of our application work together (We write these on Controllers)
* End to end tests the entire front to back end process (We write these on Views)

## Rails Testing: Setup

Navigate to the GemFile and inside of the:

1. `group :development, :test` section add:

* `gem 'factory_bot_rails'`
* `gem 'faker'`

2. `group :test,` section add:

* `gem 'rspec-rails'`
* `gem 'capybara'`
* `gem 'shoulda-matchers'`
* `gem 'launchy'`

What these gems do:

* `rspec-rails` gives us the ability to write rspec within our rails application
* `factory_bot_rails` lets us auto-create instances for our tests
* `faker` lets us generate random data for our factory_bot_instances
* `capybara` allows us to test our views or features within our application (simulate user experience)
* `shoulda-matchers` lets us test validations & associations within our models. Also gives us way better error messages
* `launchy` lets us launch external apps inside of our rails app

Once you've added your gems, run `bundle install`.

Move into the `.rspec` file and add:

```
--format documentation
--color
```

Next, move into the `application.rb` file and add:

```ruby
config.generators do |g|
  g.test_framework :rspec,
    fixtures: false,
    view_specs: false,
    helper_specs: false,
    routing_specs: false,
    controller_specs: true,
    request_specs: false
  g.fixture_replacement :factory_bot, :dir => "spec/factories"
end
```

Put `true` for whichever spec type you want to create. This will generate a spec file for each of the files you create.

## Writing Tests For Models

We will write tests for validations, associations, class methods, and error messages.

Validations: 

```ruby
describe "validations" do
  it { should validate_presence_of(:name) }
end
```

Associations: 

```ruby
describe "associations" do
  it { should have_many(:parties) }
end
```

## Using Faker to create instances which test our validations

Generator Section: https://github.com/faker-ruby/faker

```ruby
FactoryBot.define do
  factory :capy do 
    name { Faker::Name.name }
    color { Faker::Color.color }
  end
end
```

## Writing Tests For Controllers

We test for status codes, responses, and valid/invalid params.

Navigation:

* get
* post
* patch
* delete

Assertions:

* render_template
* redirect_to
* have_http_status, be_success

